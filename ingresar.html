<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro - SarahCash</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
    }

    header {
      background-color: #0c2d48;
      padding: 1rem 2rem;
    }

    header img {
      height: 50px;
    }

    main {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #0c2d48;
      margin-bottom: 2rem;
      font-size: 1.8rem;
      text-align: center;
    }

    form {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 100%;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      flex: 1 1 45%;
      display: flex;
      flex-direction: column;
    }

    label {
      margin-bottom: 0.3rem;
      font-weight: bold;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"] {
      padding: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .checkbox {
      display: flex;
      align-items: center;
      margin: 1rem 0;
    }

    .checkbox input {
      margin-right: 0.5rem;
    }

    button {
      background-color: #0c2d48;
      color: white;
      border: none;
      padding: 0.9rem 1.5rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    button:hover {
      background-color: #09314f;
    }

    .hidden {
      display: none;
    }

    #correoError {
      color: red;
      font-size: 0.9rem;
      margin-top: 0.3rem;
    }

#paso4 {
  padding: 2rem;
  min-height: 80vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}



    @media (max-width: 600px) {
      .form-group {
        flex: 1 1 100%;
      }

      h1 {
        font-size: 1.5rem;
      }
    }

.codigo-input {
  width: 40px;
  height: 50px;
  font-size: 1.5rem;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 5px;
}

#paso4 {
  padding: 2rem;
  min-height: 80vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

@media (max-width: 600px) {
  #paso4 {
    padding: 1.5rem;
    min-height: 100vh;
  }

  .codigo-input {
    width: 38px;
    height: 48px;
  }
}



  </style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBxinKVnrNfpMXzUhsGXo2dnud_0cta9kw",
    authDomain: "sarahcash-a1ec7.firebaseapp.com",
    projectId: "sarahcash-a1ec7",
    storageBucket: "sarahcash-a1ec7.firebasestorage.app",
    messagingSenderId: "188571312617",
    appId: "1:188571312617:web:1bea969d4cdfa1cfd92b78",
    measurementId: "G-W4EFD7VJGQ"
  };

  firebase.initializeApp(firebaseConfig);
</script>


</head>
<body>

  <header>
    <img src="LogoSarahcash_sin_fondo.png" alt="Logo SarahCash" />
  </header>

  <main>
    <!-- Primera sección: Registro inicial -->
    <section id="paso1">
      <h1>Regístrate, por favor</h1>
      <form id="registroForm">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" name="nombre" required />
          </div>
          <div class="form-group">
            <label for="segundoNombre">Segundo nombre (en caso de tenerlo)</label>
            <input type="text" id="segundoNombre" name="segundoNombre" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="apellidoPaterno">Apellido paterno</label>
            <input type="text" id="apellidoPaterno" name="apellidoPaterno" required />
          </div>
          <div class="form-group">
            <label for="apellidoMaterno">Apellido materno</label>
            <input type="text" id="apellidoMaterno" name="apellidoMaterno" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="flex: 1 1 100%;">
            <label for="correo">Correo electrónico</label>
            <input type="email" id="correo" name="correo" required />
            <small id="correoError" style="display: none;">Ingresa un correo electrónico válido.</small>
          </div>
        </div>

        <div class="checkbox">
          <input type="checkbox" id="noticias" name="noticias" />
          <label for="noticias">Deseo recibir noticias sobre ofertas y promociones de SarahCash.</label>
        </div>

        <button type="submit">Siguiente</button>
      </form>
    </section>

    <!-- Segunda sección: CURP y teléfono -->
    <section id="paso2" class="hidden">
      <h1>Completa tu información para continuar</h1>
      <form>
        <div class="form-group" style="margin-bottom: 1rem;">
          <input type="text" id="curp" name="curp" placeholder="Ingresa tu CURP" required />
          <small>Puedes encontrar tu CURP en tu INE, estado de cuenta del AFORE, recibo de nómina o generarlo <a href="https://www.gob.mx/curp" target="_blank">aquí</a>.</small>
        </div>

        <div class="form-group" style="margin-bottom: 1rem;">
          <input type="tel" id="celular" name="celular" placeholder="Tu número celular" required />
        </div>

        <div class="form-group" style="margin-bottom: 2rem;">
          <input type="tel" id="telefonoCasa" name="telefonoCasa" placeholder="Teléfono de casa u oficina" required />
        </div>

<button id="btnAplicacion" type="button" onclick="irAPaso3()" style="background-color: #ccc; color: #666;" disabled>
  Comienza tu aplicación
</button>
        <br><br>
        <button type="button" onclick="volverPaso1()" style="background-color: white; color: #0c2d48; border: 2px solid #0c2d48;">Regresar</button>
      </form>
    </section>

    <section id="paso3" class="hidden">
  <h1>Por favor, completa tu registro</h1>
  <form>
    <div class="form-row">
      <div class="form-group" style="flex: 1 1 45%;">
        <label>Ingresa tu correo electrónico</label>
        <input type="email" id="email3" required />
      </div>
      <div class="form-group" style="flex: 1 1 45%;">
        <label>Confirma tu correo electrónico</label>
        <input type="email" id="emailConfirm" required />
        <small id="emailError" style="color: red; display: none;">Los correos no coinciden o no son válidos.</small>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group" style="flex: 1 1 45%;">
        <label>Contraseña</label>
        <input type="password" id="password" required />
      </div>
      <div class="form-group" style="flex: 1 1 45%;">
        <label>Confirmar contraseña</label>
        <input type="password" id="passwordConfirm" required />
        <small id="passError" style="color: red; display: none;">Las contraseñas no coinciden.</small>
      </div>
    </div>

    <p>La contraseña debe tener:</p>
    <ul id="requisitosPass" style="list-style: none; padding-left: 0; margin-bottom: 1rem;">
      <li id="r1">🔴 8-20 caracteres</li>
      <li id="r2">🔴 Letras (a-z)</li>
      <li id="r3">🔴 Mayúsculas (A-Z)</li>
      <li id="r4">🔴 Números (0-9)</li>
      <li id="r5">🔴 Caracter especial (!@#$...)</li>
    </ul>

    <div class="checkbox">
      <input type="checkbox" id="chkConsulta" />
      <label for="chkConsulta"><strong>Acepto que se consulte mi historial crediticio</strong></label>
    </div>

    <div class="checkbox">
      <input type="checkbox" id="chkPoliticas" />
      <label for="chkPoliticas">He leído y acepto las <a href="#">políticas de privacidad</a></label>
    </div>

    <div class="checkbox">
      <input type="checkbox" id="chkPromos" />
      <label for="chkPromos">Acepto recibir noticias, ofertas e información relevante</label>
    </div>

  <button type="button" id="btnPaso3" onclick="irAPaso4()" style="background-color: #ccc; color: #666;" disabled>Siguiente</button>
  </form>
</section>

<!-- Paso 4: Verificación por código SMS -->
<section id="paso4" class="hidden">
  <h1>Verifica tu número de celular</h1>
  <p>Introduce el código de 6 dígitos que te enviamos por SMS al número registrado.</p>

  <form id="codigoForm">
    <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
      <input type="text" maxlength="1" class="codigo-input" />
      <input type="text" maxlength="1" class="codigo-input" />
      <input type="text" maxlength="1" class="codigo-input" />
      <input type="text" maxlength="1" class="codigo-input" />
      <input type="text" maxlength="1" class="codigo-input" />
      <input type="text" maxlength="1" class="codigo-input" />
    </div>

    <div id="recaptcha-container"></div>

    <p id="timer">¿No recibiste el código? Reenviar en <span id="countdown">30</span>s</p>
    <button type="submit" id="verificarBtn" disabled style="background-color: #ccc;">Verificar</button>
    <br><br>
    <button type="button" onclick="reenviarCodigo()" id="reenviarBtn" disabled style="background-color: white; color: #0c2d48; border: 2px solid #0c2d48;">Reenviar código</button>
  </form>
</section>



<script>
  const email3 = document.getElementById("email3");
  const emailConfirm = document.getElementById("emailConfirm");
  const password = document.getElementById("password");
  const passwordConfirm = document.getElementById("passwordConfirm");
  const btnPaso3 = document.getElementById("btnPaso3");

  const chkConsulta = document.getElementById("chkConsulta");
  const chkPoliticas = document.getElementById("chkPoliticas");

  const emailError = document.getElementById("emailError");
  const passError = document.getElementById("passError");

  const r1 = document.getElementById("r1");
  const r2 = document.getElementById("r2");
  const r3 = document.getElementById("r3");
  const r4 = document.getElementById("r4");
  const r5 = document.getElementById("r5");

  function validarPaso3() {
    const correoValido = /^[^@]+@[^@]+\.[a-zA-Z]{2,}$/.test(email3.value);
    const correosCoinciden = email3.value === emailConfirm.value;

    const pass = password.value;
    const passCoincide = pass === passwordConfirm.value;

    const largo = pass.length >= 8 && pass.length <= 20;
    const letras = /[a-z]/.test(pass);
    const mayus = /[A-Z]/.test(pass);
    const numeros = /[0-9]/.test(pass);
    const especiales = /[^a-zA-Z0-9]/.test(pass);

    // Visual para los requisitos
    r1.innerText = `${largo ? "🟢" : "🔴"} 8-20 caracteres`;
    r1.style.color = largo ? "#0c2d48" : "red";

    r2.innerText = `${letras ? "🟢" : "🔴"} Letras (a-z)`;
    r2.style.color = letras ? "#0c2d48" : "red";

    r3.innerText = `${mayus ? "🟢" : "🔴"} Mayúsculas (A-Z)`;
    r3.style.color = mayus ? "#0c2d48" : "red";

    r4.innerText = `${numeros ? "🟢" : "🔴"} Números (0-9)`;
    r4.style.color = numeros ? "#0c2d48" : "red";

    r5.innerText = `${especiales ? "🟢" : "🔴"} Caracter especial`;
    r5.style.color = especiales ? "#0c2d48" : "red";

    // Errores visibles
    emailError.style.display = correoValido && correosCoinciden ? "none" : "block";
    passError.style.display = passCoincide ? "none" : "block";

    const todosValidos = correoValido && correosCoinciden &&
      largo && letras && mayus && numeros && especiales &&
      passCoincide && chkConsulta.checked && chkPoliticas.checked;

    btnPaso3.disabled = !todosValidos;
    btnPaso3.style.backgroundColor = todosValidos ? "#0c2d48" : "#ccc";
    btnPaso3.style.color = todosValidos ? "#fff" : "#666";
    btnPaso3.style.cursor = todosValidos ? "pointer" : "default";
  }

  [email3, emailConfirm, password, passwordConfirm, chkConsulta, chkPoliticas].forEach(el => {
    el.addEventListener("input", validarPaso3);
    el.addEventListener("change", validarPaso3);
  });
</script>



  </main>

  <script>
    const registroForm = document.getElementById('registroForm');
    const paso1 = document.getElementById('paso1');
    const paso2 = document.getElementById('paso2');
    const correoInput = document.getElementById('correo');
    const correoError = document.getElementById('correoError');

    const curp = document.getElementById('curp');
    const celular = document.getElementById('celular');
    const telefonoCasa = document.getElementById('telefonoCasa');
    const btnAplicacion = document.getElementById('btnAplicacion');

    registroForm.addEventListener('submit', function(e) {
      e.preventDefault();

      if (!correoInput.checkValidity()) {
        correoError.style.display = 'block';
        correoInput.style.border = "2px solid red";
        correoInput.focus();
        return;
      } else {
        correoError.style.display = 'none';
        correoInput.style.border = "";
      }

      paso1.classList.add('hidden');
      paso2.classList.remove('hidden');
    });

    function volverPaso1() {
      paso2.classList.add('hidden');
      paso1.classList.remove('hidden');
    }

    function validarPaso2() {
      const curpValido = curp.value.trim().length > 0;
      const celularValido = celular.value.trim().length > 0;
      const telefonoValido = telefonoCasa.value.trim().length > 0;

      if (curpValido && celularValido && telefonoValido) {
        btnAplicacion.disabled = false;
        btnAplicacion.style.backgroundColor = "#0c2d48";
        btnAplicacion.style.color = "#ffffff";
        btnAplicacion.style.cursor = "pointer";
      } else {
        btnAplicacion.disabled = true;
        btnAplicacion.style.backgroundColor = "#ccc";
        btnAplicacion.style.color = "#666";
        btnAplicacion.style.cursor = "default";
      }
    }

    curp.addEventListener("input", validarPaso2);
    celular.addEventListener("input", validarPaso2);
    telefonoCasa.addEventListener("input", validarPaso2);

function irAPaso3() {
  paso2.classList.add('hidden');
  document.getElementById('paso3').classList.remove('hidden');
  document.getElementById('paso4').classList.add('hidden'); // <-- Asegura que paso4 esté oculto
}



  let confirmationResult;
  let countdown = 30;
  let timerInterval;

  function irAPaso4() {
  const rawPhone = document.getElementById("celular").value.replace(/\D/g, '');
  if (rawPhone.length !== 10) {
    alert("El número de celular debe tener 10 dígitos.");
    return;
  }

  const phoneNumber = "+52" + rawPhone;

  // Oculta paso3 y muestra paso4
  document.getElementById("paso3").classList.add("hidden");
  document.getElementById("paso4").classList.remove("hidden");

  // Re-renderizar recaptcha para evitar errores de reuso
  document.getElementById("recaptcha-container").innerHTML = "";

  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
    size: 'invisible',
    callback: function(response) {
      console.log("reCAPTCHA resuelto");
    }
  });

  window.recaptchaVerifier.render().then(() => {
    firebase.auth().signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
      .then(function(result) {
        confirmationResult = result;
        iniciarTemporizador();
        console.log("✅ Código enviado a " + phoneNumber);
      }).catch(function(error) {
        alert("❌ Error al enviar SMS: " + error.message);
      });
  });
}


  function reenviarCodigo() {
    document.getElementById("recaptcha-container").innerHTML = ""; // Reinicia captcha
    irAPaso4();
  }

  function iniciarTemporizador() {
    document.getElementById("reenviarBtn").disabled = true;
    countdown = 30;
    document.getElementById("countdown").textContent = countdown;
    clearInterval(timerInterval);

    timerInterval = setInterval(() => {
      countdown--;
      document.getElementById("countdown").textContent = countdown;
      if (countdown <= 0) {
        clearInterval(timerInterval);
        document.getElementById("reenviarBtn").disabled = false;
      }
    }, 1000);
  }

  // Unir inputs automáticamente
  const inputs = document.querySelectorAll(".codigo-input");
  inputs.forEach((input, index) => {
    input.addEventListener("input", () => {
      if (input.value.length === 1 && index < inputs.length - 1) {
        inputs[index + 1].focus();
      }
      validarCodigoCompleto();
    });
  });

  function validarCodigoCompleto() {
    const code = [...inputs].map(i => i.value).join('');
    const btn = document.getElementById("verificarBtn");

    if (code.length === 6) {
      btn.disabled = false;
      btn.style.backgroundColor = "#0c2d48";
      btn.style.color = "#fff";
    } else {
      btn.disabled = true;
      btn.style.backgroundColor = "#ccc";
      btn.style.color = "#666";
    }
  }

  // Validar código al enviar
  document.getElementById("codigoForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const code = [...inputs].map(i => i.value).join('');

    confirmationResult.confirm(code)
      .then(result => {
        alert("✅ Número verificado correctamente.");
        // Aquí podrías avanzar al siguiente paso (dashboard, resumen, etc.)
      }).catch(error => {
        alert("❌ Código incorrecto: " + error.message);
      });
  });
</script>



  </script>

</body>
</html>
